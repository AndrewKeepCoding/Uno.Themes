steps:
- task: UseGitVersion@5
  inputs:
    versionSpec: '5.3.2'
    useConfigFile: true
    configFilePath: 'build/gitversion.yml'
  displayName: 'Calculate version'

- task: NuGetToolInstaller@0
  displayName: 'Install NuGet $(NUGET_VERSION)'
  inputs:
    versionSpec: $(NUGET_VERSION)
    checkLatest: false

- task: NuGetCommand@2
  displayName: 'Restore solution packages'
  inputs:
    command: restore
    solution: $(Build.SourcesDirectory)/$(SolutionFileName)
    selectOrConfig: select
    includeNuGetOrg: true
    verbosityRestore: Normal
    noCache: true

- task: MSBuild@1
  displayName: 'Build solution in $(ApplicationConfiguration) | $(ApplicationPlatform)'
  inputs:
    solution: $(Build.SourcesDirectory)/$(SolutionFileName)
    msbuildLocationMethod: version
    msbuildVersion: latest
    msbuildArchitecture: x86
    configuration: $(ApplicationConfiguration)
    platform: $(ApplicationPlatform)
    clean: false
    maximumCpuCount: true
    restoreNugetPackages: false
    logProjectEvents: false
    createLogFile: false
    msbuildArguments: /p:PackageVersion=$(GitVersion.SemVer) # Set the version of the packages, will have no effect on application projects (Heads).

- task: PublishBuildArtifacts@1
  displayName: 'Publish artifact $(ApplicationConfiguration) | $(ApplicationPlatform)'
  inputs:
    PathtoPublish: $(PackageOutputPath)
    ArtifactName: $(ArtifactName)
    ArtifactType: Container

