<ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
                    xmlns:toolkit="using:Uno.UI.Toolkit"
                    xmlns:um="using:Uno.Material"
                    xmlns:xamarin="http://uno.ui/xamarin"
                    mc:Ignorable="xamarin">

	<!--  Converters  -->
	<um:FromNullToValueConverter x:Key="NullToScaleConverter"
	                             NotNullValue="0.7"
	                             NullValue="1" />

	<um:FromNullToValueConverter x:Key="NullToPlaceholderTranslateYConverter"
	                             NotNullValue="-11"
	                             NullValue="0" />

	<um:FromNullToValueConverter x:Key="NullToContentTranslateYConverter"
	                             NotNullValue="5"
	                             NullValue="0" />

	<um:FromNullToValueConverter x:Key="NullToPlaceholderThemeBrushConverter"
	                             NotNullValue="{StaticResource MaterialComboBoxPlaceholderFocusedThemeBrush}"
	                             NullValue="{StaticResource MaterialComboBoxPlaceholderForegroundThemeBrush}" />

	<!-- ComboBoxItem Brushes -->
	<StaticResource x:Key="MaterialComboBoxItemForegroundThemeBrush"
	                ResourceKey="OnSurfaceBrush" />

	<StaticResource x:Key="MaterialComboBoxItemSelectedBackgroundThemeBrush"
	                ResourceKey="PrimarySelectedBrush" />

	<StaticResource x:Key="MaterialComboBoxItemSelectedPointerOverBackgroundThemeBrush"
	                ResourceKey="OnSurfaceVariantHoverBrush" />

	<StaticResource x:Key="MaterialComboBoxItemPointerOverBackgroundThemeBrush"
	                ResourceKey="OnSurfaceVariantHoverBrush" />


	<!-- ComboBox Brushes -->
	<StaticResource x:Key="MaterialComboBoxBackgroundColorBrush"
	                ResourceKey="SystemControlTransparentBrush" />

	<StaticResource x:Key="MaterialComboBoxBorderBrush"
	                ResourceKey="OutlineBrush" />

	<StaticResource x:Key="MaterialComboBoxFocusedBorderBrush"
	                ResourceKey="OnBackgroundBrush" />

	<StaticResource x:Key="MaterialComboBoxOpenedBorderBrush"
	                ResourceKey="PrimaryBrush" />

	<StaticResource x:Key="MaterialComboBoxArrowForegroundThemeBrush"
	                ResourceKey="OutlineBrush" />

	<StaticResource x:Key="MaterialComboBoxOpenedArrowForegroundThemeBrush"
	                ResourceKey="PrimaryBrush" />

	<StaticResource x:Key="MaterialComboBoxForegroundThemeBrush"
	                ResourceKey="OnSurfaceBrush" />

	<StaticResource x:Key="MaterialComboBoxPlaceholderFocusedThemeBrush"
	                ResourceKey="PrimaryBrush" />

	<StaticResource x:Key="MaterialComboBoxPlaceholderForegroundThemeBrush"
	                ResourceKey="OutlineBrush" />

	<!--  CornerRadius  -->
	<CornerRadius x:Key="MaterialComboBoxCornerRadius">4</CornerRadius>

	<!--  Path Data  -->
	<x:String x:Key="UpArrowPathData">M15.995972,0L32,21.478999 0,21.478999z</x:String>
	<x:String x:Key="DownArrowPathData">M0,0L32,0 16,19.745z</x:String>

	<Thickness x:Key="MaterialComboBoxBorderThickness">1</Thickness>
	<Thickness x:Key="MaterialComboBoxOpenedBorderThickness">2</Thickness>

	<!--  Style  -->
	<Style x:Key="MaterialComboBoxItemStyle"
	       TargetType="ComboBoxItem">

		<Setter Property="Background"
		        Value="Transparent" />
		<Setter Property="Foreground"
		        Value="{StaticResource MaterialComboBoxItemForegroundThemeBrush}" />
		<Setter Property="VerticalContentAlignment"
		        Value="Center" />
		<Setter Property="HorizontalContentAlignment"
		        Value="Stretch" />
		<Setter Property="Padding"
		        Value="0" />
		<Setter Property="Height"
		        Value="50" />

		<Setter Property="Template">
			<Setter.Value>
				<ControlTemplate TargetType="ComboBoxItem">
					<Grid x:Name="RootGrid"
					      Background="{TemplateBinding Background}">

						<VisualStateManager.VisualStateGroups>
							<VisualStateGroup x:Name="CommonStates">
								<VisualState x:Name="Normal" />

								<VisualState x:Name="PointerOver">
									<VisualState.Setters>
										<Setter Target="PressedOverlay.Background"
										        Value="{ThemeResource MaterialComboBoxItemPointerOverBackgroundThemeBrush}" />
									</VisualState.Setters>
									<Storyboard>
										<DoubleAnimation Storyboard.TargetName="PressedOverlay"
										                 Storyboard.TargetProperty="Opacity"
										                 To="1"
										                 Duration="{StaticResource MaterialAnimationDuration}">
											<DoubleAnimation.EasingFunction>
												<CubicEase EasingMode="EaseIn" />
											</DoubleAnimation.EasingFunction>
										</DoubleAnimation>
									</Storyboard>
								</VisualState>

								<VisualState x:Name="Pressed">
									<VisualState.Setters>
										<Setter Target="PressedOverlay.Background"
										        Value="{ThemeResource MaterialComboBoxItemPointerOverBackgroundThemeBrush}" />
									</VisualState.Setters>
									<Storyboard>
										<DoubleAnimation Storyboard.TargetName="PressedOverlay"
										                 Storyboard.TargetProperty="Opacity"
										                 To="1"
										                 Duration="{StaticResource MaterialAnimationDuration}">
											<DoubleAnimation.EasingFunction>
												<CubicEase EasingMode="EaseIn" />
											</DoubleAnimation.EasingFunction>
										</DoubleAnimation>
									</Storyboard>
								</VisualState>

								<VisualState x:Name="Disabled">
									<VisualState.Setters>
										<Setter Target="ContentPresenter.Opacity"
										        Value="1" />
									</VisualState.Setters>
								</VisualState>

								<VisualState x:Name="Selected">
									<VisualState.Setters>
										<Setter Target="PressedOverlay.Background"
										        Value="{ThemeResource MaterialComboBoxItemSelectedBackgroundThemeBrush}" />
									</VisualState.Setters>
									<Storyboard>
										<DoubleAnimation Storyboard.TargetName="PressedOverlay"
										                 Storyboard.TargetProperty="Opacity"
										                 To="1"
										                 Duration="{StaticResource MaterialAnimationDuration}">
											<DoubleAnimation.EasingFunction>
												<CubicEase EasingMode="EaseIn" />
											</DoubleAnimation.EasingFunction>
										</DoubleAnimation>
									</Storyboard>
								</VisualState>

								<VisualState x:Name="SelectedPointerOver">
									<VisualState.Setters>
										<Setter Target="PressedOverlay.Background"
										        Value="{ThemeResource MaterialComboBoxItemSelectedPointerOverBackgroundThemeBrush}" />
									</VisualState.Setters>
									<Storyboard>
										<DoubleAnimation Storyboard.TargetName="PressedOverlay"
										                 Storyboard.TargetProperty="Opacity"
										                 To="1"
										                 Duration="{StaticResource MaterialAnimationDuration}">
											<DoubleAnimation.EasingFunction>
												<CubicEase EasingMode="EaseIn" />
											</DoubleAnimation.EasingFunction>
										</DoubleAnimation>
									</Storyboard>
								</VisualState>

								<VisualState x:Name="SelectedDisabled">
									<VisualState.Setters>
										<Setter Target="ContentPresenter.Opacity"
										        Value="1" />
									</VisualState.Setters>
								</VisualState>

								<VisualState x:Name="SelectedPressed">
									<VisualState.Setters>
										<Setter Target="PressedOverlay.Background"
										        Value="{ThemeResource MaterialComboBoxItemSelectedBackgroundThemeBrush}" />
									</VisualState.Setters>
									<Storyboard>
										<DoubleAnimation Storyboard.TargetName="PressedOverlay"
										                 Storyboard.TargetProperty="Opacity"
										                 To="1"
										                 Duration="{StaticResource MaterialAnimationDuration}">
											<DoubleAnimation.EasingFunction>
												<CubicEase EasingMode="EaseIn" />
											</DoubleAnimation.EasingFunction>
										</DoubleAnimation>
									</Storyboard>
								</VisualState>
							</VisualStateGroup>
						</VisualStateManager.VisualStateGroups>

						<!--  Pressed Overlay  -->
						<Grid x:Name="PressedOverlay"
						      HorizontalAlignment="Stretch"
						      VerticalAlignment="Stretch"
						      Background="{StaticResource MaterialComboBoxItemSelectedBackgroundThemeBrush}"
						      IsHitTestVisible="False"
						      Opacity="0" />

						<!--  ContentPresenter  -->
						<ContentPresenter x:Name="ContentPresenter"
						                  Content="{TemplateBinding Content}"
						                  ContentTransitions="{TemplateBinding ContentTransitions}">
							<ContentPresenter.ContentTemplate>
								<DataTemplate>
									<Grid>
										<TextBlock Margin="16,0,0,0"
										           VerticalAlignment="Center"
										           Foreground="{TemplateBinding Foreground}"
										           Style="{StaticResource MaterialLabelLarge}"
										           Text="{Binding}" />
									</Grid>
								</DataTemplate>
							</ContentPresenter.ContentTemplate>
						</ContentPresenter>
					</Grid>
				</ControlTemplate>
			</Setter.Value>
		</Setter>
	</Style>

	<Style x:Key="MaterialComboBoxStyle"
	       TargetType="ComboBox">

		<Setter Property="Foreground"
		        Value="{ThemeResource MaterialComboBoxForegroundThemeBrush}" />
		<Setter Property="Background"
		        Value="{StaticResource MaterialComboBoxBackgroundColorBrush}" />
		<Setter Property="BorderBrush"
		        Value="{StaticResource MaterialComboBoxBorderBrush}" />
		<Setter Property="BorderThickness"
		        Value="{StaticResource MaterialComboBoxBorderThickness}" />
		<Setter Property="Padding"
		        Value="0" />
		<Setter Property="MinHeight"
		        Value="50" />
		<Setter Property="TabNavigation"
		        Value="Once" />
		<Setter Property="ScrollViewer.HorizontalScrollBarVisibility"
		        Value="Disabled" />
		<Setter Property="ScrollViewer.VerticalScrollBarVisibility"
		        Value="Auto" />
		<Setter Property="ScrollViewer.HorizontalScrollMode"
		        Value="Disabled" />
		<Setter Property="ScrollViewer.VerticalScrollMode"
		        Value="Auto" />
		<Setter Property="ScrollViewer.IsVerticalRailEnabled"
		        Value="True" />
		<Setter Property="ScrollViewer.IsDeferredScrollingEnabled"
		        Value="False" />
		<Setter Property="ScrollViewer.BringIntoViewOnFocusChange"
		        Value="True" />
		<Setter Property="HorizontalContentAlignment"
		        Value="Stretch" />
		<Setter Property="HorizontalAlignment"
		        Value="Stretch" />
		<Setter Property="ItemContainerStyle"
		        Value="{StaticResource MaterialComboBoxItemStyle}" />
		<xamarin:Setter Property="uno:ComboBox.DropDownPreferredPlacement"
		                Value="Below" />

		<!--  Workaround for WinUI issue: https://github.com/microsoft/microsoft-ui-xaml/issues/6388  -->
		<Setter Property="um:ControlExtensions.Icon"
		        Value="{x:Null}" />

		<Setter Property="ItemsPanel">
			<Setter.Value>
				<ItemsPanelTemplate>
					<CarouselPanel />
				</ItemsPanelTemplate>
			</Setter.Value>
		</Setter>

		<Setter Property="Template">
			<Setter.Value>
				<ControlTemplate TargetType="ComboBox">
					<Grid x:Name="RootGrid"
					      HorizontalAlignment="Stretch"
					      Background="{TemplateBinding Background}"
					      BorderBrush="{TemplateBinding BorderBrush}"
					      BorderThickness="{TemplateBinding BorderThickness}"
					      CornerRadius="{StaticResource MaterialComboBoxCornerRadius}">
						<VisualStateManager.VisualStateGroups>
							<VisualStateGroup x:Name="CommonStates">
								<VisualState x:Name="Normal" />
								<VisualState x:Name="PointerOver" />
								<VisualState x:Name="Pressed" />

								<VisualState x:Name="Disabled">
									<VisualState.Setters>
										<Setter Target="DropDownGlyph_Down.Fill"
										        Value="{StaticResource OnSurfaceLowBrush}" />
										<Setter Target="PlaceholderElement.Foreground"
										        Value="{StaticResource OnSurfaceLowBrush}" />
										<Setter Target="ContentPresenter.Foreground"
										        Value="{StaticResource OnSurfaceLowBrush}" />
										<Setter Target="IconPresenter.Foreground"
										        Value="{StaticResource OnSurfaceLowBrush}" />
									</VisualState.Setters>
								</VisualState>
							</VisualStateGroup>

							<VisualStateGroup x:Name="DropDownStates">

								<VisualState x:Name="Opened">
									<VisualState.Setters>
										<Setter Target="RootGrid.BorderBrush"
										        Value="{StaticResource MaterialComboBoxOpenedBorderBrush}" />
										<Setter Target="RootGrid.BorderThickness"
										        Value="{StaticResource MaterialComboBoxOpenedBorderThickness}" />
										<Setter Target="DropDownGlyph_Up.Fill"
										        Value="{StaticResource MaterialComboBoxOpenedArrowForegroundThemeBrush}" />
										<Setter Target="DropDownGlyph_Down.Visibility"
										        Value="Collapsed" />
										<Setter Target="DropDownGlyph_Up.Visibility"
										        Value="Visible" />
									</VisualState.Setters>
									<Storyboard>

										<SplitOpenThemeAnimation ClosedLength="{Binding TemplateSettings.DropDownClosedHeight, RelativeSource={RelativeSource Mode=TemplatedParent}}"
										                         ClosedTargetName="ContentPresenter"
										                         ContentTargetName="ScrollViewer"
										                         ContentTranslationOffset="0"
										                         OffsetFromCenter="{Binding TemplateSettings.DropDownOffset, RelativeSource={RelativeSource Mode=TemplatedParent}}"
										                         OpenedLength="{Binding TemplateSettings.DropDownOpenedHeight, RelativeSource={RelativeSource Mode=TemplatedParent}}"
										                         OpenedTargetName="PopupBorder" />
									</Storyboard>
								</VisualState>

								<VisualState x:Name="Closed">
									<VisualState.Setters>
										<Setter Target="RootGrid.BorderBrush"
										        Value="{StaticResource MaterialComboBoxBorderBrush}" />
										<Setter Target="RootGrid.BorderThickness"
										        Value="{StaticResource MaterialComboBoxBorderThickness}" />
										<Setter Target="DropDownGlyph_Down.Visibility"
										        Value="Visible" />
										<Setter Target="DropDownGlyph_Up.Visibility"
										        Value="Collapsed" />
									</VisualState.Setters>
									<Storyboard>
										<SplitCloseThemeAnimation ClosedLength="{Binding TemplateSettings.DropDownClosedHeight, RelativeSource={RelativeSource Mode=TemplatedParent}}"
										                          ClosedTargetName="ContentPresenter"
										                          ContentTargetName="ScrollViewer"
										                          ContentTranslationDirection="{Binding TemplateSettings.SelectedItemDirection, RelativeSource={RelativeSource Mode=TemplatedParent}}"
										                          ContentTranslationOffset="40"
										                          OffsetFromCenter="{Binding TemplateSettings.DropDownOffset, RelativeSource={RelativeSource Mode=TemplatedParent}}"
										                          OpenedLength="{Binding TemplateSettings.DropDownOpenedHeight, RelativeSource={RelativeSource Mode=TemplatedParent}}"
										                          OpenedTargetName="PopupBorder" />
									</Storyboard>
								</VisualState>
							</VisualStateGroup>
						</VisualStateManager.VisualStateGroups>
						<Grid x:Name="ComboBoxContent"
						      Background="{TemplateBinding Background}"
						      CornerRadius="{StaticResource MaterialComboBoxCornerRadius}">
							<Grid.ColumnDefinitions>
								<ColumnDefinition Width="*" />
								<ColumnDefinition Width="40" />
							</Grid.ColumnDefinitions>

							<Grid Margin="16,0"
							      CornerRadius="{StaticResource MaterialComboBoxCornerRadius}">
								<Grid.Resources>
									<!--  Resources added here in order to manage the ContentPresenter TranslateY depending if there is a PlaceholderText or not  -->
									<CompositeTransform x:Key="ContentPresenter_CompositeTransformWithPlaceholder"
									                    TranslateY="{Binding SelectedItem, RelativeSource={RelativeSource TemplatedParent}, Converter={StaticResource NullToContentTranslateYConverter}, TargetNullValue=0, FallbackValue=0}" />

									<CompositeTransform x:Key="ContentPresenter_CompositeTransformWithoutPlaceholder"
									                    TranslateY="0" />

									<um:FromEmptyStringToValueConverter x:Key="EmptyToCompositeTransformConverter"
									                                    NotNullOrEmptyValue="{StaticResource ContentPresenter_CompositeTransformWithPlaceholder}"
									                                    NullOrEmptyValue="{StaticResource ContentPresenter_CompositeTransformWithoutPlaceholder}" />
								</Grid.Resources>
								<Grid.ColumnDefinitions>
									<ColumnDefinition Width="Auto" />
									<ColumnDefinition Width="*" />
								</Grid.ColumnDefinitions>

								<!--  IconPresenter  -->
								<ContentPresenter x:Name="IconPresenter"
								                  MinWidth="25"
								                  MaxWidth="34"
								                  MaxHeight="34"
								                  Margin="0,0,8,0"
								                  HorizontalAlignment="Center"
								                  VerticalAlignment="Center"
								                  Content="{Binding Path=(um:ControlExtensions.Icon), RelativeSource={RelativeSource TemplatedParent}}"
								                  Visibility="{Binding Path=(um:ControlExtensions.Icon), RelativeSource={RelativeSource TemplatedParent}, Converter={StaticResource MaterialNullToCollapsedConverter}, FallbackValue=Collapsed, TargetNullValue=Collapsed}" />

								<!--  ContentPresenter  -->
								<ContentPresenter x:Name="ContentPresenter"
								                  Grid.Column="1"
								                  VerticalAlignment="Center"
								                  RenderTransform="{Binding PlaceholderText, RelativeSource={RelativeSource TemplatedParent}, Converter={StaticResource EmptyToCompositeTransformConverter}, TargetNullValue={StaticResource ContentPresenter_CompositeTransformWithoutPlaceholder}, FallbackValue={StaticResource ContentPresenter_CompositeTransformWithoutPlaceholder}}" />

								<!--  PlaceholderElement  -->
								<TextBlock x:Name="PlaceholderElement"
								           Grid.Column="1"
								           VerticalAlignment="Center"
								           Foreground="{Binding SelectedItem, RelativeSource={RelativeSource TemplatedParent}, Converter={StaticResource NullToPlaceholderThemeBrushConverter}, TargetNullValue={StaticResource MaterialComboBoxPlaceholderForegroundThemeBrush}, FallbackValue={StaticResource MaterialComboBoxPlaceholderForegroundThemeBrush}}"
								           IsHitTestVisible="False"
								           MaxLines="1"
								           RenderTransformOrigin="0,0.5"
								           Style="{StaticResource MaterialLabelMedium}"
								           Text="{TemplateBinding PlaceholderText}">
									<TextBlock.RenderTransform>
										<CompositeTransform x:Name="PlaceholderElement_CompositeTransform"
										                    ScaleX="{Binding SelectedItem, RelativeSource={RelativeSource TemplatedParent}, Converter={StaticResource NullToScaleConverter}, TargetNullValue=1, FallbackValue=1}"
										                    ScaleY="{Binding SelectedItem, RelativeSource={RelativeSource TemplatedParent}, Converter={StaticResource NullToScaleConverter}, TargetNullValue=1, FallbackValue=1}"
										                    TranslateY="{Binding SelectedItem, RelativeSource={RelativeSource TemplatedParent}, Converter={StaticResource NullToPlaceholderTranslateYConverter}, TargetNullValue=0, FallbackValue=0}" />
									</TextBlock.RenderTransform>
								</TextBlock>
							</Grid>

							<!--  Down  -->
							<Path x:Name="DropDownGlyph_Down"
							      Grid.Column="1"
							      Width="10"
							      Height="5"
							      HorizontalAlignment="Center"
							      VerticalAlignment="Center"
							      Data="{StaticResource DownArrowPathData}"
							      Fill="{ThemeResource MaterialComboBoxArrowForegroundThemeBrush}"
							      Stretch="Uniform" />

							<!--  Up  -->
							<Path x:Name="DropDownGlyph_Up"
							      Grid.Column="1"
							      Width="10"
							      Height="5"
							      HorizontalAlignment="Center"
							      VerticalAlignment="Center"
							      Data="{StaticResource UpArrowPathData}"
							      Fill="{ThemeResource MaterialComboBoxArrowForegroundThemeBrush}"
							      Stretch="Uniform"
							      Visibility="Collapsed" />

							<!--  Popup  -->
							<Popup x:Name="Popup">
								<Border x:Name="PopupBorder"
										CornerRadius="{StaticResource MaterialComboBoxCornerRadius}"
								        Background="{StaticResource SurfaceBrush}">

									<!--  Workaround for Issue #213 where android PopupBorder doesn't get redrawn properly, adds Background, CornerRadius and Border to ScrollViewer  -->
									<ScrollViewer x:Name="ScrollViewer"
									              MinWidth="{ThemeResource ComboBoxPopupThemeMinWidth}"
									              AutomationProperties.AccessibilityView="Raw"
									              BringIntoViewOnFocusChange="{TemplateBinding ScrollViewer.BringIntoViewOnFocusChange}"
									              CornerRadius="{StaticResource MaterialComboBoxCornerRadius}"
									              HorizontalScrollBarVisibility="{TemplateBinding ScrollViewer.HorizontalScrollBarVisibility}"
									              HorizontalScrollMode="{TemplateBinding ScrollViewer.HorizontalScrollMode}"
									              IsDeferredScrollingEnabled="{TemplateBinding ScrollViewer.IsDeferredScrollingEnabled}"
									              IsHorizontalRailEnabled="{TemplateBinding ScrollViewer.IsHorizontalRailEnabled}"
									              IsVerticalRailEnabled="{TemplateBinding ScrollViewer.IsVerticalRailEnabled}"
									              VerticalScrollBarVisibility="{TemplateBinding ScrollViewer.VerticalScrollBarVisibility}"
									              VerticalScrollMode="{TemplateBinding ScrollViewer.VerticalScrollMode}"
									              VerticalSnapPointsAlignment="Near"
									              VerticalSnapPointsType="OptionalSingle"
									              ZoomMode="Disabled">
										<ItemsPresenter />
									</ScrollViewer>
								</Border>
							</Popup>
						</Grid>
					</Grid>
				</ControlTemplate>
			</Setter.Value>
		</Setter>
	</Style>
</ResourceDictionary>
